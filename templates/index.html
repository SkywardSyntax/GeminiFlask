<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Conversational Gemini Chat</title>
	<link rel="stylesheet" href="{{ url_for('static', filename='main.css') }}">
</head>
<body>
	<header>
		<div class="header-container">
			<h1>Conversational Gemini Chat</h1>
		</div>
	</header>

	<div class="container">
		<div id="chat-container">
			{% for message in chat_history %}
				{% if message.role == 'model' %}
					<p class="bot-message">Bot: 
						{% if message.parts is defined %} 
							{{ message.parts|safe }} 
						{% else %}
							{{ message.content|safe }} 
						{% endif %}
					</p>
				{% elif message.role == 'user' %}
					<p class="user-message">You: 
						{% if message.parts is defined %} 
							{{ message.parts[0]|safe }} 
						{% else %}
							{{ message.content|safe }} 
						{% endif %}
					</p>
				{% endif %}
			{% endfor %}
		</div>

		<form id="chat-form" method="POST">
			<input type="text" id="message" name="message" placeholder="Enter your message" required>
			<button type="submit">Send</button>
		</form>
		<form id="clear-form" method="POST">
			<button type="submit" name="clear-history" value="clear">Clear History</button>
		</form>
		<button id="dark-mode-toggle">Toggle Dark Mode</button>
	</div>

	<div class="footer-spacer"></div>

	<footer>
		<div class="footer-container">
			<p>&copy; 2023 Conversational Gemini Chat. All rights reserved.</p>
		</div>
	</footer>

	<script>
		const chatForm = document.getElementById('chat-form');
		const clearForm = document.getElementById('clear-form'); 
		const chatContainer = document.getElementById('chat-container');
		const darkModeToggle = document.getElementById('dark-mode-toggle');

		chatForm.addEventListener('submit', (event) => {
			event.preventDefault(); 

			const messageInput = document.getElementById('message');
			const userMessage = messageInput.value;

			displayMessage('user', userMessage); 

			fetch('/', {
				method: 'POST',
				headers: {
					'Content-Type': 'application/x-www-form-urlencoded',
				},
				body: `message=${userMessage}`,
			})
			.then(response => response.json()) // Parse response as JSON
			.then(data => {
				displayMessage('model', data.answer); 
			})
			.catch(error => {
				console.error('Error:', error);
				displayMessage('error', 'An error occurred.');
			});

			messageInput.value = ''; 
		});

		clearForm.addEventListener('submit', (event) => {
			event.preventDefault();

			chatContainer.innerHTML = ''; 

			fetch('/', {
				method: 'POST',
				headers: {
					'Content-Type': 'application/x-www-form-urlencoded',
				},
				body: 'clear-history=clear', 
			})
			.catch(error => {
				console.error('Error:', error);
				displayMessage('error', 'An error occurred.');
			});
		});

		darkModeToggle.addEventListener('click', () => {
			document.body.classList.toggle('dark-mode');
		});

		function displayMessage(role, message) {
			const messageElement = document.createElement('p');
			messageElement.classList.add(role === 'user' ? 'user-message' : 'bot-message');
			messageElement.innerHTML = `${role === 'user' ? 'You' : 'Bot'}: ${message}`;
			chatContainer.appendChild(messageElement);

			chatContainer.scrollTop = chatContainer.scrollHeight;
			applyMessageStyles();
		}

		function applyMessageStyles() {
			const messages = chatContainer.querySelectorAll('p');
			messages.forEach(message => {
				if (message.classList.contains('user-message')) {
					message.style.textAlign = 'right';
					message.style.color = '#4CAF50';
					message.style.backgroundColor = '#e8f5e9';
					message.style.borderRadius = '15px 15px 0 15px';
					message.style.alignSelf = 'flex-end';
				} else if (message.classList.contains('bot-message')) {
					message.style.textAlign = 'left';
					message.style.color = '#2196F3';
					message.style.backgroundColor = '#e3f2fd';
					message.style.borderRadius = '15px 15px 15px 0';
					message.style.alignSelf = 'flex-start';
				}
			});
		}

		// Apply styles to existing messages on page load
		document.addEventListener('DOMContentLoaded', applyMessageStyles);
	</script>
</body>
</html>
