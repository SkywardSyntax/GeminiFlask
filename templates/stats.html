<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stats</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='main.css') }}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <header>
        <div class="header-container">
            <h1>Stats Page</h1>
        </div>
    </header>

    <div id="dark-mode-circle"></div> <!-- Circle for dark mode toggle -->

    <div class="container stats-container">
        <h1>Total Requests</h1>
        <p>The total number of requests made is: <span id="request-count">{{ count }}</span></p>
        <canvas id="request-chart" width="400" height="200"></canvas>
    </div>

    <footer>
        <div class="footer-container">
            <p>&copy; 2024 Conversational Gemini Chat. All rights reserved.</p>
        </div>
    </footer>

    <script>
        const darkModeCircle = document.getElementById('dark-mode-circle');

        darkModeCircle.addEventListener('click', () => {
            document.body.classList.toggle('dark-mode');
        });

        function updateRequestCount() {
            fetch('/request-count')
                .then(response => response.json())
                .then(data => {
                    document.getElementById('request-count').textContent = data.count;
                })
                .catch(error => console.error('Error fetching request count:', error));
        }

        function updateRequestChart() {
            fetch('/request-data')
                .then(response => response.json())
                .then(data => {
                    const ctx = document.getElementById('request-chart').getContext('2d');
                    new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels: data.timestamps,
                            datasets: [{
                                label: 'Request Count Over Time',
                                data: data.counts,
                                borderColor: 'rgba(75, 192, 192, 1)',
                                borderWidth: 1,
                                fill: false
                            }]
                        },
                        options: {
                            scales: {
                                x: {
                                    type: 'time',
                                    time: {
                                        unit: 'minute'
                                    }
                                },
                                y: {
                                    beginAtZero: true
                                }
                            }
                        }
                    });
                })
                .catch(error => console.error('Error fetching request data:', error));
        }

        setInterval(updateRequestCount, 5000); // Update every 5 seconds
        setInterval(updateRequestChart, 60000); // Update chart every minute
    </script>
</body>
</html>
